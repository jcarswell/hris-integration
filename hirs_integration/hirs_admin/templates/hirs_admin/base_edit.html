{% extends "hirs_admin/base.html" %}
{% load i18n static %}

{% block page_actions %}
{% if form_delete %}
<div class="btn-toolbar mb-2 mb-md-0">
  <a class="btn btn-md btn-danger" id="btn_delete" onclick="do_delete()">Delete</a>
<div>
{% endif %}
{% endblock %}

{% block content %}
<div class="container">
  {% block feild_set %}
  <form id="form_list" {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}>
    {% csrf_token %}
    {{ form.as_form }}
    <button type="submit" class="btn btn-primary">submit</button>
  </form>
  {% endblock %}
<div>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'hirs_admin/dist/js/cookie.js' %}"></script>
<script src="{% static 'hirs_admin/dist/js/alerts.js' %}"></script>
<script>
var id = $('#form_list input[type=number]')[0]
$("#form_list").submit(function(e) {
  e.preventDefault();
  data = $(this).serializeArray()
  if (id !== undefined) {data.push({name:id.name,value:id.value});}

  $.ajax({
    method: "POST",
    url: location.href,
    data: data
  })
  .done(function(data) {
    doneProcess(data);
    if (is_new()) {
      if (id !== undefined) {location.reload(function(){return get_basepath() + id.value + '/';})}
      else {location.reload(function(){return get_basepath();})}
    }
  })
  .fail(function(jqXHR,Status,error) {errorProcess(jqXHR,status,error);});
});
function do_delete() {
  $.ajax({
    method: "delete",
    url: location.href,
    })
  .done(function(data){
    location.reload(get_basepath());
  })
  .fail(function(jqXHR,Status,error) {errorProcess(jqXHR,status,error);});
}
function is_new() {
  if (isNaN(get_id())) {return undefined;}
  else if (get_id > 0) {return false;}
  else {return true;}
}
$(function() {
  if (is_new()) {
    if (id !== undefined) {
      id.disabled = false;
      id.readOnly = false;
    }
  }
  const csrftoken = getCookie('csrftoken')
  $.ajaxSetup({
    headers: { "X-CSRFToken": csrftoken }
  });
});
</script>
{% endblock %}
